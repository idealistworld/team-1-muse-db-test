Running the test scripts
Basic Usage
Run the connection test script:
bashpython3 test_connection.py
Authentication Options
When you run the script, you'll be prompted:
🔐 Run tests with authentication? (y/n):
Option 1: Authenticated Tests (Enter y)

Uses the TEST_USER_EMAIL and TEST_USER_PASSWORD from your .env file
Tests will run as a logged-in user
Verifies that RLS policies correctly allow authenticated users to access their own data
Tests INSERT operations and verifies cleanup

Option 2: Anonymous Tests (Enter n)

Runs without authentication
Verifies that RLS policies correctly block anonymous users
Useful for confirming your security is working properly

What the Tests Do
The script runs 5 test suites:

Connection Test - Verifies basic connectivity to Supabase
Read Operations - Tests SELECT queries on your tables
Write Operations - Tests INSERT (with automatic cleanup) on tables
RLS Protection - Verifies Row Level Security is enforcing access controls
Join Operations - Tests foreign key relationships work correctly

Expected Output
A successful authenticated run looks like:
🔗 Supabase Connection Test
============================================================

✅ Authenticated as: your-test-email@example.com
   User ID: abc-123-def-456

🔍 Discovering tables and schema...
✅ Found 7 tables: user_profiles, creator_profiles, creator_content, user_posts, user_media, user_follows, post_inspirations

1️⃣  CONNECTION TEST
------------------------------------------------------------
✅ PASSED - Connected to Supabase successfully

2️⃣  READ OPERATIONS TEST
------------------------------------------------------------
✅ PASSED - Can read from 'user_profiles' (0 rows)
✅ PASSED - Can read from 'creator_profiles' (0 rows)
✅ PASSED - Can read from 'creator_content' (0 rows)

3️⃣  WRITE OPERATIONS TEST
------------------------------------------------------------
✅ PASSED - Insert to 'user_profiles' succeeded
   🔍 Inserted record: {'user_id': '...', 'subscription_tier': 'pro', ...}
   🧹 Deleted test record (confirmed cleanup)

4️⃣  RLS PROTECTION TEST
------------------------------------------------------------
✅ PASSED - 'user_profiles': Authenticated read returned 0 rows

5️⃣  JOIN OPERATIONS TEST
------------------------------------------------------------
✅ PASSED - Join user_follows -> creator_profiles
   Retrieved 0 joined record(s)

============================================================
✨ Test suite complete!
Troubleshooting
"Authentication failed" error:

Check that TEST_USER_EMAIL and TEST_USER_PASSWORD are set correctly in .env
Verify the user exists in Supabase (Authentication → Users)
Ensure the email is confirmed if email confirmation is enabled

"Row-level security" or "permission denied" errors:

If running authenticated tests: Check your RLS policies allow the operation
If running anonymous tests: This is expected and means RLS is working correctly

"Check constraint" errors:

The test data doesn't meet your database constraints
Check the error details to see which constraint failed
Common issues: invalid enum values, URL format requirements

No tables found:

Verify you've created the database schema in Supabase
Check your SUPABASE_URL is pointing to the correct project
Ensure tables are in the public schema

Testing Tips

Run authenticated tests first to verify everything works end-to-end
Run anonymous tests to confirm security policies are blocking unauthorized access
Check the detailed output - the script shows raw responses for debugging
Tests clean up after themselves - INSERT tests automatically delete test records